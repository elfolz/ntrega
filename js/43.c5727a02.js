"use strict";(globalThis["webpackChunkNtrega"]=globalThis["webpackChunkNtrega"]||[]).push([[43],{5043:(e,t,a)=>{a.r(t),a.d(t,{default:()=>y});a(7658);var n=a(3396),i=a(7139);const l=e=>((0,n.dD)("data-v-31aa121f"),e=e(),(0,n.Cn)(),e),s=l((()=>(0,n._)("label",null,"NF",-1))),d={key:0},o=l((()=>(0,n._)("label",null,"Distância",-1))),r=l((()=>(0,n._)("label",null,"Data entrega",-1))),u=l((()=>(0,n._)("label",null,"Endereço",-1))),c=l((()=>(0,n._)("label",null,"Status",-1))),p={key:0},h=l((()=>(0,n._)("label",null,"Pagamento",-1))),g={key:0},m={key:0};function v(e,t,a,l,v,w){const f=(0,n.up)("v-select"),k=(0,n.up)("v-text-field"),D=(0,n.up)("v-date-picker"),N=(0,n.up)("v-locale-provider"),F=(0,n.up)("v-menu"),_=(0,n.up)("v-btn"),y=(0,n.up)("v-icon"),b=(0,n.up)("v-list-item-title"),V=(0,n.up)("v-list-item"),W=(0,n.up)("v-list"),$=(0,n.up)("nf-deliver"),C=(0,n.up)("v-dialog"),T=(0,n.up)("dialog-confirmation");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n._)("header",null,[(0,n.Wm)(f,{modelValue:v.currentView,"onUpdate:modelValue":[t[0]||(t[0]=e=>v.currentView=e),t[1]||(t[1]=e=>w.open())],"hide-details":"",density:"compact",items:w.views,"item-title":"title","item-value":"value"},null,8,["modelValue","items"]),(0,n.Wm)(F,{"close-on-content-click":!1,modelValue:v.menuDatePicker,"onUpdate:modelValue":t[4]||(t[4]=e=>v.menuDatePicker=e)},{activator:(0,n.w5)((({props:e})=>[(0,n.Wm)(k,(0,n.dG)({value:v.date.toLocaleDateString()},e,{readonly:"","hide-details":"","append-inner-icon":"edit",density:"compact","onClick:appendInner":t[2]||(t[2]=e=>v.menuDatePicker=!0)}),null,16,["value"])])),default:(0,n.w5)((()=>[(0,n.Wm)(N,{locale:"pt"},{default:(0,n.w5)((()=>[(0,n.Wm)(D,{modelValue:v.date,"onUpdate:modelValue":[t[3]||(t[3]=e=>v.date=e),w.pickDate],"hide-actions":"","show-adjacent-months":"",color:"primary"},null,8,["modelValue","onUpdate:modelValue"])])),_:1})])),_:1},8,["modelValue"])]),(0,n._)("main",null,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(v.packages,(e=>((0,n.wg)(),(0,n.iD)("section",{class:(0,i.C_)(["elevation-4",1==e.delivered?"deliver_success":0==e.delivered?"deliver_fail":null])},[(0,n._)("header",null,[(0,n._)("article",null,[s,(0,n._)("span",null,(0,i.zw)(e.nf),1)]),"day"==v.currentView&&v.date.valueOf()==w.today?((0,n.wg)(),(0,n.iD)("article",d,[o,(0,n._)("span",null,(0,i.zw)(w.translateDistanceance(e.distance)),1)])):(0,n.kq)("",!0),(0,n._)("article",null,[r,(0,n._)("span",null,(0,i.zw)(w.numberToDate(e.date)),1)])]),(0,n._)("article",null,[u,(0,n._)("span",null,(0,i.zw)(e.address)+" N° "+(0,i.zw)(e.number||"S/N")+", "+(0,i.zw)(e.district)+", "+(0,i.zw)(e.city)+" - "+(0,i.zw)(e.state),1)]),(0,n._)("footer",null,[(0,n._)("article",null,[c,(0,n._)("span",null,(0,i.zw)(1==e.delivered?"✅ Entregue":0==e.delivered?"🚫 Ausente":"⏳ Pendente"),1)]),e.paymentMethod?((0,n.wg)(),(0,n.iD)("article",p,[h,(0,n._)("span",null,(0,i.zw)(w.paymentMethod(e.paymentMethod)),1)])):(0,n.kq)("",!0),(0,n._)("article",null,[(0,n.Wm)(F,null,{activator:(0,n.w5)((({props:e})=>[(0,n.Wm)(_,(0,n.dG)({variant:"text",icon:"more_horiz"},e),null,16)])),default:(0,n.w5)((()=>[(0,n.Wm)(W,null,{default:(0,n.w5)((()=>[(0,n.Wm)(V,{onClick:t=>w.editStatus(e)},{prepend:(0,n.w5)((()=>[(0,n.Wm)(y,{icon:"edit"})])),default:(0,n.w5)((()=>[(0,n.Wm)(b,null,{default:(0,n.w5)((()=>[(0,n.Uk)("Mudar status")])),_:1})])),_:2},1032,["onClick"]),e.date.valueOf()!=w.today?((0,n.wg)(),(0,n.j4)(V,{key:0,onClick:t=>w.bringToToday(e.nf)},{prepend:(0,n.w5)((()=>[(0,n.Wm)(y,{icon:"update"})])),default:(0,n.w5)((()=>[(0,n.Wm)(b,null,{default:(0,n.w5)((()=>[(0,n.Uk)("Trazer para hoje")])),_:1})])),_:2},1032,["onClick"])):(0,n.kq)("",!0),void 0!=e.delivered?((0,n.wg)(),(0,n.j4)(V,{key:1,onClick:t=>w.revertStatus(e.nf)},{prepend:(0,n.w5)((()=>[(0,n.Wm)(y,{icon:"replay"})])),default:(0,n.w5)((()=>[(0,n.Wm)(b,null,{default:(0,n.w5)((()=>[(0,n.Uk)("Reverter status")])),_:1})])),_:2},1032,["onClick"])):(0,n.kq)("",!0),(0,n.Wm)(V,{onClick:t=>w.remove(e.nf)},{prepend:(0,n.w5)((()=>[(0,n.Wm)(y,{icon:"delete"})])),default:(0,n.w5)((()=>[(0,n.Wm)(b,null,{default:(0,n.w5)((()=>[(0,n.Uk)("Excluir NF")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])])],2)))),256)),v.packages.length?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("span",g," Não há NFs para esta data. "))]),(0,n._)("footer",null,[v.packages?.length?((0,n.wg)(),(0,n.iD)("span",m,(0,i.zw)(v.deliveredNFs)+" / "+(0,i.zw)(v.packages.length)+" NFs entregues",1)):(0,n.kq)("",!0),(0,n.Wm)(_,{variant:"text",onClick:t[5]||(t[5]=t=>e.$router.push("/"))},{default:(0,n.w5)((()=>[(0,n.Wm)(y,{icon:"clear"}),(0,n.Uk)(" Fechar")])),_:1})]),(0,n.Wm)(C,{modelValue:v.dialogNFDeliver,"onUpdate:modelValue":t[7]||(t[7]=e=>v.dialogNFDeliver=e),persistent:""},{default:(0,n.w5)((()=>[(0,n.Wm)($,{ref:"nfDeliver",onClose:t[6]||(t[6]=e=>v.dialogNFDeliver=!1),onNfStatusUpdated:w.nfStatusUpdated},null,8,["onNfStatusUpdated"])])),_:1},8,["modelValue"]),(0,n.Wm)(T,{ref:"dialogConfirmation",onConfirm:t[8]||(t[8]=e=>w.confirm())},null,512)],64)}var w=a(8776),f=a(6229),k=a(7769),D=a(5298);const N={name:"nf-list",emits:["close"],components:{nfDeliver:k.Z,dialogConfirmation:f.Z},computed:{refreshMap:{get(){return this.$store.state.refreshMap},set(e){this.$store.commit("setRefreshMap",e)}},today(){return(new Date).setHours(0,0,0,0).valueOf()},coords(){return this.$store.state.coords},views(){return[{title:"Dia",value:"day"},{title:"Semana",value:"week"},{title:"Mês",value:"month"}]}},data(){return{date:new Date,packages:[],pendingNF:null,menuView:!1,menuDatePicker:!1,pendingAction:null,dialogNFDeliver:!1,deliveredNFs:0,currentView:"day"}},mounted(){this.open()},methods:{open(){const e=this.date.setHours(0,0,0,0).valueOf();let t=this.$idb.packages.where({date:e});if("week"==this.currentView){const a=new Date(e).getDate(),n=new Date(e).getDay(),i=new Date(e).setDate(a-n),l=new Date(e).setDate(a-n+6);t=this.$idb.packages.where("date").between(i,l,!0,!0)}else if("month"==this.currentView){const a=new Date(new Date(e).setDate(1)),n=new Date(new Date(a).setMonth(new Date(a).getMonth()+1)),i=new Date(n).setDate(n.getDate()-1);t=this.$idb.packages.where("date").between(new Date(e).setDate(1).valueOf(),i,!0,!0)}t.toArray().then((t=>{e==this.today&&"day"==this.currentView?this.packages=(0,w.cU)(t,this.coords.latitude,this.coords.longitude):"day"==this.currentView?this.packages=(0,w.z9)(t):"day"!=this.currentView&&(this.packages=(0,w.df)(t)),this.menuDatePicker=!1,this.calcDeliveredNFs()}))},revertStatus(e){this.pendingAction="revert",this.pendingNF=e,this.$refs.dialogConfirmation.open(`Reverter status da NF <strong>${e}</strong> ?`)},bringToToday(e){this.pendingAction="bringToToday",this.pendingNF=e,this.$refs.dialogConfirmation.open(`Trazer a NF <strong>${e}</strong> para a data de hoje ?`)},remove(e){this.pendingAction="delete",this.pendingNF=e,this.$refs.dialogConfirmation.open(`Excluir a NF <strong>${e}</strong> ?`)},confirm(){this.pendingNF&&this.pendingAction&&("revert"==this.pendingAction&&this.revertNF(),"bringToToday"==this.pendingAction&&this.bringNFToToday(),"delete"==this.pendingAction&&this.deleteNF(),this.pendingAction=null)},editStatus(e){this.dialogNFDeliver||(this.dialogNFDeliver=!0,this.$nextTick((()=>{this.$refs.nfDeliver.open(e)})))},nfStatusUpdated(){this.open(),this.refreshMap=!0},revertNF(){this.pendingNF&&this.$idb.packages.update(this.pendingNF,{delivered:void 0,paymentMethod:void 0}).then((()=>{const e=this.packages.findIndex((e=>e.nf==this.pendingNF));this.packages[e].delivered=void 0,this.$store.dispatch("openAlert",{text:"Status de entrega revertido com sucesso",color:"success"}),this.calcDeliveredNFs(),this.refreshMap=!0,this.open()})).finally((()=>{this.pendingNF=null}))},bringNFToToday(){this.pendingNF&&this.$idb.packages.update(this.pendingNF,{date:this.today,delivered:void 0,paymentMethod:void 0}).then((()=>{const e=this.packages.findIndex((e=>e.nf==this.pendingNF));this.packages.splice(e,1),this.$store.dispatch("openAlert",{text:"Data da NF atualizada com sucesso",color:"success"}),this.calcDeliveredNFs(),this.refreshMap=!0,this.open()})).finally((()=>{this.pendingNF=null}))},deleteNF(){this.pendingNF&&this.$idb.packages.delete(this.pendingNF).then((()=>{this.$store.dispatch("openAlert",{text:"NF deletada com sucesso",color:"success"}),this.refreshMap=!0,this.open()})).catch((e=>{this.$store.dispatch("openAlert",{text:"Falha ao deletar NF",color:"error"}),console.log(e)})).finally((()=>{this.pendingNF=null}))},calcDeliveredNFs(){this.deliveredNFs=this.packages.reduce(((e,t)=>(1==t.delivered&&e++,e)),0)},translateDistanceance(e){return(0,w.Yz)(e)},numberToDate(e){return new Date(e).toLocaleDateString()},paymentMethod(e){return D.Z.find((t=>t.id==e))?.name??"N/A"},pickDate(e){this.date=e,this.open()}}};var F=a(89);const _=(0,F.Z)(N,[["render",v],["__scopeId","data-v-31aa121f"]]),y=_}}]);