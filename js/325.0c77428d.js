"use strict";(globalThis["webpackChunkNtrega"]=globalThis["webpackChunkNtrega"]||[]).push([[325],{2382:(e,t,a)=>{a.r(t),a.d(t,{default:()=>F});a(7658);var i=a(3396),n=a(7139);const l=e=>((0,i.dD)("data-v-22e1c97b"),e=e(),(0,i.Cn)(),e),s=l((()=>(0,i._)("span",null,"NFs para o dia",-1))),d=l((()=>(0,i._)("label",null,"NF",-1))),o={key:0},r=l((()=>(0,i._)("label",null,"Distância",-1))),u=l((()=>(0,i._)("label",null,"Endereço",-1))),c=l((()=>(0,i._)("label",null,"Status",-1))),p={key:0},h={key:0};function g(e,t,a,l,g,v){const f=(0,i.up)("v-text-field"),m=(0,i.up)("v-date-picker"),k=(0,i.up)("v-locale-provider"),N=(0,i.up)("v-menu"),w=(0,i.up)("v-btn"),F=(0,i.up)("v-icon"),_=(0,i.up)("v-list-item-title"),D=(0,i.up)("v-list-item"),y=(0,i.up)("v-list"),b=(0,i.up)("nf-deliver"),T=(0,i.up)("v-dialog"),W=(0,i.up)("dialog-confirmation");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("header",null,[s,(0,i.Wm)(N,{"close-on-content-click":!1,modelValue:g.menuDatePicker,"onUpdate:modelValue":t[1]||(t[1]=e=>g.menuDatePicker=e)},{activator:(0,i.w5)((({props:e})=>[(0,i.Wm)(f,(0,i.dG)({value:g.date?.toLocaleDateString(),readonly:"","hide-details":""},e,{"append-inner-icon":"edit",density:"compact"}),null,16,["value"])])),default:(0,i.w5)((()=>[(0,i.Wm)(k,{locale:"pt"},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{modelValue:g.date,"onUpdate:modelValue":[t[0]||(t[0]=e=>g.date=e),v.pickDate],"hide-actions":"",color:"primary"},null,8,["modelValue","onUpdate:modelValue"])])),_:1})])),_:1},8,["modelValue"])]),(0,i._)("main",null,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(g.packages,(e=>((0,i.wg)(),(0,i.iD)("section",{class:(0,n.C_)(["elevation-4",1==e.delivered?"deliver_success":0==e.delivered?"deliver_fail":null])},[(0,i._)("header",null,[(0,i._)("article",null,[d,(0,i._)("span",null,(0,n.zw)(e.nf),1)]),g.date.valueOf()>=v.today?((0,i.wg)(),(0,i.iD)("article",o,[r,(0,i._)("span",null,(0,n.zw)(v.valueToDist(e.distance)),1)])):(0,i.kq)("",!0)]),(0,i._)("article",null,[u,(0,i._)("span",null,(0,n.zw)(e.address)+" N° "+(0,n.zw)(e.number||"S/N")+", "+(0,n.zw)(e.district)+" - "+(0,n.zw)(e.state),1)]),(0,i._)("footer",null,[(0,i._)("article",null,[c,(0,i._)("span",null,(0,n.zw)(1==e.delivered?"Entregue":0==e.delivered?"Destinatário ausente":"Pendente de entrega"),1)]),(0,i._)("article",null,[(0,i.Wm)(N,null,{activator:(0,i.w5)((({props:e})=>[(0,i.Wm)(w,(0,i.dG)({variant:"text",icon:"more_horiz"},e),null,16)])),default:(0,i.w5)((()=>[(0,i.Wm)(y,null,{default:(0,i.w5)((()=>[(0,i.Wm)(D,{onClick:t=>v.editStatus(e)},{prepend:(0,i.w5)((()=>[(0,i.Wm)(F,{icon:"edit"})])),default:(0,i.w5)((()=>[(0,i.Wm)(_,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Mudar status")])),_:1})])),_:2},1032,["onClick"]),g.date.valueOf()!=v.today?((0,i.wg)(),(0,i.j4)(D,{key:0,onClick:t=>v.bringToToday(e.nf)},{prepend:(0,i.w5)((()=>[(0,i.Wm)(F,{icon:"update"})])),default:(0,i.w5)((()=>[(0,i.Wm)(_,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Trazer para hoje")])),_:1})])),_:2},1032,["onClick"])):(0,i.kq)("",!0),void 0!=e.delivered?((0,i.wg)(),(0,i.j4)(D,{key:1,onClick:t=>v.revertStatus(e.nf)},{prepend:(0,i.w5)((()=>[(0,i.Wm)(F,{icon:"replay"})])),default:(0,i.w5)((()=>[(0,i.Wm)(_,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Reverter status")])),_:1})])),_:2},1032,["onClick"])):(0,i.kq)("",!0)])),_:2},1024)])),_:2},1024)])])],2)))),256)),g.packages.length?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("span",p," Não há NFs para esta data. "))]),(0,i._)("footer",null,[g.packages?.length?((0,i.wg)(),(0,i.iD)("span",h,(0,n.zw)(g.deliveredNFs)+" / "+(0,n.zw)(g.packages.length)+" NFs entregues",1)):(0,i.kq)("",!0),(0,i.Wm)(w,{variant:"text",onClick:t[2]||(t[2]=t=>e.$router.push("/"))},{default:(0,i.w5)((()=>[(0,i.Wm)(F,{icon:"clear"}),(0,i.Uk)(" Fechar")])),_:1})]),(0,i.Wm)(T,{modelValue:g.dialogNFDeliver,"onUpdate:modelValue":t[4]||(t[4]=e=>g.dialogNFDeliver=e),persistent:""},{default:(0,i.w5)((()=>[(0,i.Wm)(b,{ref:"nfDeliver",onClose:t[3]||(t[3]=e=>g.dialogNFDeliver=!1),onNfStatusUpdated:v.nfStatusUpdated},null,8,["onNfStatusUpdated"])])),_:1},8,["modelValue"]),(0,i.Wm)(W,{ref:"dialogConfirmation",onConfirm:t[5]||(t[5]=e=>v.confirm())},null,512)],64)}var v=a(8776),f=a(6229),m=a(383);const k={name:"nf-list",emits:["close"],components:{nfDeliver:m.Z,dialogConfirmation:f.Z},computed:{refreshMap:{get(){return this.$store.state.refreshMap},set(e){this.$store.commit("setRefreshMap",e)}},today(){return(new Date).setHours(0,0,0,0).valueOf()},coords(){return this.$store.state.coords}},data(){return{date:new Date,packages:[],pendingNF:null,menuDatePicker:!1,pendingAction:null,dialogNFDeliver:!1,deliveredNFs:0}},mounted(){this.open()},methods:{open(){const e=this.date.setHours(0,0,0,0).valueOf();this.$idb.packages.where({date:e}).toArray().then((t=>{e==this.today?this.packages=(0,v.cU)(t,this.coords.latitude,this.coords.longitude):this.packages=(0,v.z9)(t),this.menuDatePicker=!1,this.calcDeliveredNFs()}))},revertStatus(e){this.pendingAction="revert",this.pendingNF=e,this.$refs.dialogConfirmation.open(`Reverter status da NF <strong>${e}</strong> ?`)},bringToToday(e){this.pendingAction="bringToToday",this.pendingNF=e,this.$refs.dialogConfirmation.open(`Trazer a NF <strong>${e}</strong> para a data de hoje ?`)},confirm(){this.pendingNF&&this.pendingAction&&("revert"==this.pendingAction&&this.revertNF(),"bringToToday"==this.pendingAction&&this.bringNFToToday(),this.pendingAction=null)},editStatus(e){this.dialogNFDeliver||(this.dialogNFDeliver=!0,this.$nextTick((()=>{this.$refs.nfDeliver.open(e)})))},nfStatusUpdated(){this.open(),this.refreshMap=!0},revertNF(){this.pendingNF&&this.$idb.packages.update(this.pendingNF,{delivered:void 0}).then((()=>{const e=this.packages.findIndex((e=>e.nf==this.pendingNF));this.packages[e].delivered=void 0,this.$store.dispatch("openAlert",{text:"Status de entrega revertido com sucesso",color:"success"}),this.calcDeliveredNFs(),this.refreshMap=!0})).finally((()=>{this.pendingNF=null}))},bringNFToToday(){this.pendingNF&&this.$idb.packages.update(this.pendingNF,{date:this.today,delivered:void 0}).then((()=>{const e=this.packages.findIndex((e=>e.nf==this.pendingNF));this.packages.splice(e,1),this.$store.dispatch("openAlert",{text:"Data da NF atualizada com sucesso",color:"success"}),this.calcDeliveredNFs(),this.refreshMap=!0})).finally((()=>{this.pendingNF=null}))},calcDeliveredNFs(){this.deliveredNFs=this.packages.reduce(((e,t)=>(1==t.delivered&&e++,e)),0)},valueToDist(e){return(0,v.kF)(e)},pickDate(e){this.date=e,this.open()}}};var N=a(89);const w=(0,N.Z)(k,[["render",g],["__scopeId","data-v-22e1c97b"]]),F=w}}]);