"use strict";(globalThis["webpackChunkNtrega"]=globalThis["webpackChunkNtrega"]||[]).push([[593],{9593:(t,e,a)=>{a.r(e),a.d(e,{default:()=>U});a(7658);var s=a(3396),i=a(7139);const n=t=>((0,s.dD)("data-v-55f7ec27"),t=t(),(0,s.Cn)(),t),r={key:0},l={key:1},o={key:0},c={key:1},d=n((()=>(0,s._)("h2",null,"Você ainda não tem assinaturas.",-1))),u=n((()=>(0,s._)("h3",null,"Quer liberar todas funcionalidades do app?",-1))),p=n((()=>(0,s._)("p",null,[(0,s._)("span",{class:"emoji"},"♾️"),(0,s.Uk)("Cadastro de NFs ilimitado")],-1))),m=n((()=>(0,s._)("p",null,[(0,s._)("span",{class:"emoji"},"🚚"),(0,s.Uk)("Rotas com paradas ilimitadas")],-1))),h=n((()=>(0,s._)("p",null,[(0,s._)("span",{class:"emoji"},"☁️"),(0,s.Uk)("Dados salvos na núvem")],-1))),b=n((()=>(0,s._)("p",null,[(0,s._)("span",{class:"emoji"},"❎"),(0,s.Uk)("Exporte seus dados para Excel")],-1))),g=n((()=>(0,s._)("h3",null,"Quer liberar todas funcionalidades do app?",-1))),k=n((()=>(0,s._)("h1",null,"Escolha seu plano",-1))),v={key:0},w=n((()=>(0,s._)("div",{id:"mercadopago_container"},null,-1)));function y(t,e,a,n,y,_){const f=(0,s.up)("v-skeleton-loader"),P=(0,s.up)("v-list-item"),D=(0,s.up)("v-divider"),x=(0,s.up)("v-list"),S=(0,s.up)("v-icon"),U=(0,s.up)("v-btn"),W=(0,s.up)("v-window-item"),C=(0,s.up)("v-window");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(C,{modelValue:y.tabIndex,"onUpdate:modelValue":e[2]||(e[2]=t=>y.tabIndex=t)},{default:(0,s.w5)((()=>[(0,s.Wm)(W,null,{default:(0,s.w5)((()=>[_.authenticated?((0,s.wg)(),(0,s.iD)("h1",r,"Minhas assinaturas")):(0,s.kq)("",!0),_.authenticated&&y.loading?((0,s.wg)(),(0,s.iD)("section",l,[(0,s.Wm)(f,{type:"list-item-avatar-three-line"})])):((0,s.wg)(),(0,s.iD)(s.HY,{key:2},[y.subscriptions.length?((0,s.wg)(),(0,s.iD)("section",o,[(0,s.Wm)(x,{class:"transparent"},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(y.subscriptions,((t,e)=>((0,s.wg)(),(0,s.iD)(s.HY,{key:e},[(0,s.Wm)(P,{title:t.description,subtitle:_.subtitle(t)},{append:(0,s.w5)((()=>[(0,s._)("span",null,(0,i.zw)(_.statusName(t)),1),(0,s._)("label",{class:(0,i.C_)(_.statusCss(t))},null,2)])),_:2},1032,["title","subtitle"]),e<y.subscriptions.length-1?((0,s.wg)(),(0,s.j4)(D,{key:0})):(0,s.kq)("",!0)],64)))),128))])),_:1}),(0,s.Wm)(U,{block:"",color:"primary",onClick:e[0]||(e[0]=t=>_.subscribe())},{default:(0,s.w5)((()=>[(0,s.Wm)(S,null,{default:(0,s.w5)((()=>[(0,s.Uk)("payment")])),_:1}),(0,s.Uk)(" Assinar novamente")])),_:1})])):((0,s.wg)(),(0,s.iD)("section",c,[_.authenticated?((0,s.wg)(),(0,s.iD)(s.HY,{key:0},[d,u],64)):((0,s.wg)(),(0,s.iD)(s.HY,{key:1},[p,m,h,b,g],64)),(0,s.Wm)(U,{block:"",color:"primary",onClick:e[1]||(e[1]=t=>_.subscribe())},{default:(0,s.w5)((()=>[(0,s.Wm)(S,null,{default:(0,s.w5)((()=>[(0,s.Uk)("payment")])),_:1}),(0,s.Uk)(" Assinar agora")])),_:1})]))],64))])),_:1}),(0,s.Wm)(W,null,{default:(0,s.w5)((()=>[k,(0,s.Wm)(x,{class:"transparent full-height"},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(_.plans,((t,e)=>((0,s.wg)(),(0,s.iD)(s.HY,{key:e},[(0,s.Wm)(P,{title:t.name,onClick:e=>_.selectPlan(t),class:(0,i.C_)({selected:y.selectedPlan?.name==t.name})},{append:(0,s.w5)((()=>[(0,s._)("span",null,(0,i.zw)(_.currency(t.price)),1),t.discount?((0,s.wg)(),(0,s.iD)("span",v,(0,i.zw)(t.discount)+"% off",1)):(0,s.kq)("",!0)])),_:2},1032,["title","onClick","class"]),e<_.plans.length-1?((0,s.wg)(),(0,s.j4)(D,{key:0})):(0,s.kq)("",!0)],64)))),128))])),_:1})])),_:1}),(0,s.Wm)(W,null,{default:(0,s.w5)((()=>[y.mercadoPagoLoaded?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)(s.HY,{key:0},[(0,s.Wm)(f,{type:"list-item-avatar-two-line"}),(0,s.Wm)(f,{type:"list-item-avatar-two-line"}),(0,s.Wm)(f,{type:"list-item-avatar-two-line"}),(0,s.Wm)(f,{type:"list-item-avatar-two-line"}),(0,s.Wm)(f,{type:"button"})],64)),w])),_:1})])),_:1},8,["modelValue"]),(0,s._)("footer",null,[y.tabIndex>0?((0,s.wg)(),(0,s.j4)(U,{key:0,variant:"text",onClick:e[3]||(e[3]=t=>_.previousTab())},{default:(0,s.w5)((()=>[(0,s.Wm)(S,{icon:"arrow_back"}),(0,s.Uk)(" Voltar")])),_:1})):(0,s.kq)("",!0),(0,s.Wm)(U,{variant:"text",onClick:e[4]||(e[4]=e=>t.$router.push("/"))},{default:(0,s.w5)((()=>[(0,s.Wm)(S,{icon:"clear"}),(0,s.Uk)(" Fechar")])),_:1})])],64)}var _=a(4870),f=a(7130),P=a(5734);const D={computed:{authenticated(){return this.$store.state.authenticated},plans(){return[{name:"Mensal",price:19.9},{name:"Trimestral",price:59.9,discount:10},{name:"Semestral",price:99.9,discount:20},{name:"Anual",price:169.9,discount:30}]},today(){return(new Date).setHours(0,0,0,0).valueOf()},activeSubscription:{get(){return this.$store.state.activeSubscription},set(t){this.$store.commit("setActiveSubscription",t)}}},data(){return{loading:!1,tabIndex:parseInt(this.$route.params.tabIndex||"0"),subscriptions:[],dbListener:null,mp:null,mpScript:null,selectedPlan:null,mercadoPagoLoaded:!1,bricks:null,currencyFormatter:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",maximumFractionDigits:2})}},mounted(){"true"==this.$route.query.test&&this.plans.push({name:"Diária",price:1}),this.listenSubscriptions(),this.loadMercadoPago()},beforeUnmount(){this.dbListener&&this.dbListener(),this.mpScript&&document.body.removeChild(this.mpScript)},methods:{listenSubscriptions(){!this.dbListener&&this.$auth.user.id&&(this.dbListener=(0,f.jM)((0,f.iH)(P.db,`transactions/${this.$auth.user.id}`),(t=>{t.exists()&&(this.activeSubscription=Object.values(t.val())?.some((t=>t.activeUntil>this.today)),this.subscriptions=Object.entries(t.val()).map((t=>(t[1].id=t[0],t[1]))).sort(((t,e)=>"approved"==t.status&&"approved"!=e.status?-1:"approved"==e.status&&"approved"!=t.status?1:0)))})))},loadMercadoPago(){this.mpScript=document.createElement("script"),this.mpScript.async=!0,this.mpScript.defer=!0,this.mpScript.src="/js/mercadopago.js",this.mpScript.onload=()=>this.mp=new MercadoPago("APP_USR-4fb8ffdd-a9bf-4f4e-bf15-0c086ce0a8d2",{locale:"pt-BR",trackingDisabled:!0}),document.body.appendChild(this.mpScript)},renderMercadoPago(){this.selectedPlan&&(0,_.IU)(this.mp).bricks().create("payment","mercadopago_container",{initialization:{amount:this.selectedPlan.price,redirectMode:"modal"},customization:{paymentMethods:{creditCard:"all",debitCard:"all",ticket:"all",bankTransfer:"all",mercadoPago:"all",atm:"all"}},callbacks:{onReady:()=>{this.mercadoPagoLoaded=!0},onSubmit:t=>{const e=Object.assign(t.formData,{description:`Ntrega assinatura ${this.selectedPlan.name}`,external_reference:this.$auth.user.id});fetch("https://payment-process-mn5noearoa-uc.a.run.app/payment_process",{method:"POST",headers:this.$auth.headers,body:JSON.stringify(e)}).then((t=>{if(![200,201].includes(t.status))throw null;this.tabIndex=0})).catch((()=>{this.$store.dispatch("openAlert",{text:"Falha realizar o pagamento.",color:"error"}),this.previousTab()}))},onError:t=>{console.log(t)}}}).then((t=>{this.bricks=t}))},selectPlan(t){this.mercadoPagoLoaded=!1,(0,_.IU)(this.bricks)?.unmount(),this.selectedPlan=t,this.tabIndex=2,this.$nextTick((()=>{this.renderMercadoPago()}))},subscribe(){if(!this.authenticated)return localStorage.setItem("pendingPath","/subscriptions/1"),this.$router.push("/login").catch((t=>{}));this.tabIndex=1},previousTab(){2!=this.tabIndex&&(this.mercadoPagoLoaded=!1,(0,_.IU)(this.bricks)?.unmount(),this.selectedPlan=null),this.tabIndex>0&&this.tabIndex--},currency(t){return this.currencyFormatter.format(t)},subtitle(t){return t.activeUntil?`Ativa até ${new Date(t.activeUntil).toLocaleDateString()}`:"Aguardando pagamento"},statusName(t){return"approved"==t.status?t.activeUntil>this.today?"Ativa":"Expirada":"Pendente"},statusCss(t){return"approved"==t.status?t.activeUntil>this.today?"active":"expired":"pending"}}};var x=a(89);const S=(0,x.Z)(D,[["render",y],["__scopeId","data-v-55f7ec27"]]),U=S}}]);