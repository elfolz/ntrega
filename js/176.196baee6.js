"use strict";(globalThis["webpackChunkNtrega"]=globalThis["webpackChunkNtrega"]||[]).push([[176],{5176:(e,t,a)=>{a.r(t),a.d(t,{default:()=>N});a(7658);var i=a(3396),n=a(7139);const l=e=>((0,i.dD)("data-v-591702fe"),e=e(),(0,i.Cn)(),e),s=l((()=>(0,i._)("label",null,"NF",-1))),d={key:0},r=l((()=>(0,i._)("label",null,"Distância",-1))),o=l((()=>(0,i._)("label",null,"Data entrega",-1))),u=l((()=>(0,i._)("label",null,"Endereço",-1))),c=l((()=>(0,i._)("label",null,"Status",-1))),p={key:0},h={key:0};function g(e,t,a,l,g,v){const m=(0,i.up)("v-select"),w=(0,i.up)("v-text-field"),f=(0,i.up)("v-date-picker"),D=(0,i.up)("v-locale-provider"),k=(0,i.up)("v-menu"),N=(0,i.up)("v-btn"),_=(0,i.up)("v-icon"),F=(0,i.up)("v-list-item-title"),y=(0,i.up)("v-list-item"),b=(0,i.up)("v-list"),V=(0,i.up)("nf-deliver"),T=(0,i.up)("v-dialog"),W=(0,i.up)("dialog-confirmation");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("header",null,[(0,i.Wm)(m,{modelValue:g.currentView,"onUpdate:modelValue":[t[0]||(t[0]=e=>g.currentView=e),t[1]||(t[1]=e=>v.open())],"hide-details":"",density:"compact",items:v.views,"item-title":"title","item-value":"value"},null,8,["modelValue","items"]),(0,i.Wm)(k,{"close-on-content-click":!1,modelValue:g.menuDatePicker,"onUpdate:modelValue":t[4]||(t[4]=e=>g.menuDatePicker=e)},{activator:(0,i.w5)((({props:e})=>[(0,i.Wm)(w,(0,i.dG)({value:g.date.toLocaleDateString()},e,{readonly:"","hide-details":"","append-inner-icon":"edit",density:"compact","onClick:appendInner":t[2]||(t[2]=e=>g.menuDatePicker=!0)}),null,16,["value"])])),default:(0,i.w5)((()=>[(0,i.Wm)(D,{locale:"pt"},{default:(0,i.w5)((()=>[(0,i.Wm)(f,{modelValue:g.date,"onUpdate:modelValue":[t[3]||(t[3]=e=>g.date=e),v.pickDate],"hide-actions":"","show-adjacent-months":"",color:"primary"},null,8,["modelValue","onUpdate:modelValue"])])),_:1})])),_:1},8,["modelValue"])]),(0,i._)("main",null,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(g.packages,(e=>((0,i.wg)(),(0,i.iD)("section",{class:(0,n.C_)(["elevation-4",1==e.delivered?"deliver_success":0==e.delivered?"deliver_fail":null])},[(0,i._)("header",null,[(0,i._)("article",null,[s,(0,i._)("span",null,(0,n.zw)(e.nf),1)]),"day"==g.currentView&&g.date.valueOf()==v.today?((0,i.wg)(),(0,i.iD)("article",d,[r,(0,i._)("span",null,(0,n.zw)(v.valueToDist(e.distance)),1)])):(0,i.kq)("",!0),(0,i._)("article",null,[o,(0,i._)("span",null,(0,n.zw)(v.numberToDate(e.date)),1)])]),(0,i._)("article",null,[u,(0,i._)("span",null,(0,n.zw)(e.address)+" N° "+(0,n.zw)(e.number||"S/N")+", "+(0,n.zw)(e.district)+", "+(0,n.zw)(e.city)+" - "+(0,n.zw)(e.state),1)]),(0,i._)("footer",null,[(0,i._)("article",null,[c,(0,i._)("span",null,(0,n.zw)(1==e.delivered?"Entregue":0==e.delivered?"Destinatário ausente":"Pendente de entrega"),1)]),(0,i._)("article",null,[(0,i.Wm)(k,null,{activator:(0,i.w5)((({props:e})=>[(0,i.Wm)(N,(0,i.dG)({variant:"text",icon:"more_horiz"},e),null,16)])),default:(0,i.w5)((()=>[(0,i.Wm)(b,null,{default:(0,i.w5)((()=>[(0,i.Wm)(y,{onClick:t=>v.editStatus(e)},{prepend:(0,i.w5)((()=>[(0,i.Wm)(_,{icon:"edit"})])),default:(0,i.w5)((()=>[(0,i.Wm)(F,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Mudar status")])),_:1})])),_:2},1032,["onClick"]),g.date.valueOf()!=v.today?((0,i.wg)(),(0,i.j4)(y,{key:0,onClick:t=>v.bringToToday(e.nf)},{prepend:(0,i.w5)((()=>[(0,i.Wm)(_,{icon:"update"})])),default:(0,i.w5)((()=>[(0,i.Wm)(F,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Trazer para hoje")])),_:1})])),_:2},1032,["onClick"])):(0,i.kq)("",!0),void 0!=e.delivered?((0,i.wg)(),(0,i.j4)(y,{key:1,onClick:t=>v.revertStatus(e.nf)},{prepend:(0,i.w5)((()=>[(0,i.Wm)(_,{icon:"replay"})])),default:(0,i.w5)((()=>[(0,i.Wm)(F,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Reverter status")])),_:1})])),_:2},1032,["onClick"])):(0,i.kq)("",!0)])),_:2},1024)])),_:2},1024)])])],2)))),256)),g.packages.length?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("span",p," Não há NFs para esta data. "))]),(0,i._)("footer",null,[g.packages?.length?((0,i.wg)(),(0,i.iD)("span",h,(0,n.zw)(g.deliveredNFs)+" / "+(0,n.zw)(g.packages.length)+" NFs entregues",1)):(0,i.kq)("",!0),(0,i.Wm)(N,{variant:"text",onClick:t[5]||(t[5]=t=>e.$router.push("/"))},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{icon:"clear"}),(0,i.Uk)(" Fechar")])),_:1})]),(0,i.Wm)(T,{modelValue:g.dialogNFDeliver,"onUpdate:modelValue":t[7]||(t[7]=e=>g.dialogNFDeliver=e),persistent:""},{default:(0,i.w5)((()=>[(0,i.Wm)(V,{ref:"nfDeliver",onClose:t[6]||(t[6]=e=>g.dialogNFDeliver=!1),onNfStatusUpdated:v.nfStatusUpdated},null,8,["onNfStatusUpdated"])])),_:1},8,["modelValue"]),(0,i.Wm)(W,{ref:"dialogConfirmation",onConfirm:t[8]||(t[8]=e=>v.confirm())},null,512)],64)}var v=a(8776),m=a(6229),w=a(383);const f={name:"nf-list",emits:["close"],components:{nfDeliver:w.Z,dialogConfirmation:m.Z},computed:{refreshMap:{get(){return this.$store.state.refreshMap},set(e){this.$store.commit("setRefreshMap",e)}},today(){return(new Date).setHours(0,0,0,0).valueOf()},coords(){return this.$store.state.coords},views(){return[{title:"Dia",value:"day"},{title:"Semana",value:"week"},{title:"Mês",value:"month"}]}},data(){return{date:new Date,packages:[],pendingNF:null,currentView:"day",menuView:!1,menuDatePicker:!1,pendingAction:null,dialogNFDeliver:!1,deliveredNFs:0}},mounted(){this.open()},methods:{open(){const e=this.date.setHours(0,0,0,0).valueOf();let t=this.$idb.packages.where({date:e});if("week"==this.currentView){const a=new Date(e).getDate(),i=new Date(e).getDay(),n=new Date(e).setDate(a-i),l=new Date(e).setDate(a-i+6);t=this.$idb.packages.where("date").between(n,l,!0,!0)}else if("month"==this.currentView){const a=new Date(new Date(e).setDate(1)),i=new Date(new Date(a).setMonth(new Date(a).getMonth()+1)),n=new Date(i).setDate(i.getDate()-1);t=this.$idb.packages.where("date").between(new Date(e).setDate(1).valueOf(),n,!0,!0)}t.toArray().then((t=>{e==this.today&&"day"==this.currentView?this.packages=(0,v.cU)(t,this.coords.latitude,this.coords.longitude):"day"==this.currentView?this.packages=(0,v.z9)(t):"day"!=this.currentView&&(this.packages=(0,v.df)(t)),this.menuDatePicker=!1,this.calcDeliveredNFs()}))},revertStatus(e){this.pendingAction="revert",this.pendingNF=e,this.$refs.dialogConfirmation.open(`Reverter status da NF <strong>${e}</strong> ?`)},bringToToday(e){this.pendingAction="bringToToday",this.pendingNF=e,this.$refs.dialogConfirmation.open(`Trazer a NF <strong>${e}</strong> para a data de hoje ?`)},confirm(){this.pendingNF&&this.pendingAction&&("revert"==this.pendingAction&&this.revertNF(),"bringToToday"==this.pendingAction&&this.bringNFToToday(),this.pendingAction=null)},editStatus(e){this.dialogNFDeliver||(this.dialogNFDeliver=!0,this.$nextTick((()=>{this.$refs.nfDeliver.open(e)})))},nfStatusUpdated(){this.open(),this.refreshMap=!0},revertNF(){this.pendingNF&&this.$idb.packages.update(this.pendingNF,{delivered:void 0}).then((()=>{const e=this.packages.findIndex((e=>e.nf==this.pendingNF));this.packages[e].delivered=void 0,this.$store.dispatch("openAlert",{text:"Status de entrega revertido com sucesso",color:"success"}),this.calcDeliveredNFs(),this.refreshMap=!0})).finally((()=>{this.pendingNF=null}))},bringNFToToday(){this.pendingNF&&this.$idb.packages.update(this.pendingNF,{date:this.today,delivered:void 0}).then((()=>{const e=this.packages.findIndex((e=>e.nf==this.pendingNF));this.packages.splice(e,1),this.$store.dispatch("openAlert",{text:"Data da NF atualizada com sucesso",color:"success"}),this.calcDeliveredNFs(),this.refreshMap=!0})).finally((()=>{this.pendingNF=null}))},calcDeliveredNFs(){this.deliveredNFs=this.packages.reduce(((e,t)=>(1==t.delivered&&e++,e)),0)},valueToDist(e){return(0,v.kF)(e)},numberToDate(e){return new Date(e).toLocaleDateString()},pickDate(e){this.date=e,this.open()}}};var D=a(89);const k=(0,D.Z)(f,[["render",g],["__scopeId","data-v-591702fe"]]),N=k}}]);